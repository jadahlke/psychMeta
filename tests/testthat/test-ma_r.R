library(psychmeta)


test_that("barebones analysis; data = data_r_meas_multi", {
  expected <-
    data.frame(
      analysis_id = c(1L, 2L, 3L, 4L, 5L, 6L, 7L, 8L, 9L),
      pair_id = c(1L, 1L, 1L, 2L, 2L, 2L, 3L, 3L, 3L),
      meta_tables = c(
        list(barebones = list(k = 40, N = 11927, mean_r = 0.316664279389441, var_r = 0.015607018191014, var_e = 0.0027311653471958, var_res = 0.0128758528438182, sd_r = 0.124928052058031, se_r = 0.0197528594075731, sd_e = 0.0522605524960825, sd_res = 0.113471815195749, CI_LL_95 = 0.27671035002098, CI_UL_95 = 0.356618208757902, CR_LL_80 = 0.168738042379361, CR_UL_80 = 0.464590516399522), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 20, N = 5623, mean_r = 0.397105936009967, var_r = 0.0078546146241952, var_e = 0.00254502592488503, var_res = 0.00530958869931017, sd_r = 0.0886262637382125, se_r = 0.0198174350310468, sd_e = 0.0504482499685076, sd_res = 0.0728669245907234, CI_LL_95 = 0.355627567793312, CI_UL_95 = 0.438584304226622, CR_LL_80 = 0.300358464725835, CR_UL_80 = 0.493853407294099), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 20, N = 6304, mean_r = 0.244912465433665, var_r = 0.0118041071270113, var_e = 0.00281316635920628, var_res = 0.00899094076780505, sd_r = 0.108646707851694, se_r = 0.0242941424287948, sd_e = 0.0530392907117571, sd_res = 0.0948205714378744, CI_LL_95 = 0.194064240948976, CI_UL_95 = 0.295760689918354, CR_LL_80 = 0.119016517939558, CR_UL_80 = 0.370808412927771), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 40, N = 11927, mean_r = 0.323567060376143, var_r = 0.0166013429198125, var_e = 0.00270440067599763, var_res = 0.0138969422438149, sd_r = 0.128846198701446, se_r = 0.0203723727875599, sd_e = 0.0520038525111133, sd_res = 0.117885292737537, CI_LL_95 = 0.282360046919142, CI_UL_95 = 0.364774073833145, CR_LL_80 = 0.169887243732574, CR_UL_80 = 0.477246877019712), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 20, N = 5623, mean_r = 0.422059682152634, var_r = 0.00850294865414287, var_e = 0.00242299853307206, var_res = 0.00607995012107081, sd_r = 0.092211434508649, se_r = 0.0206191035864109, sd_e = 0.0492239629964112, sd_res = 0.0779740349159309, CI_LL_95 = 0.378903402365939, CI_UL_95 = 0.465215961939329, CR_LL_80 = 0.318531356423112, CR_UL_80 = 0.525588007882156), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 20, N = 6304, mean_r = 0.235714266554886, var_r = 0.00741886013571419, var_e = 0.00283968920107585, var_res = 0.00457917093463834, sd_r = 0.0861328052237601, se_r = 0.0192598807573077, sd_e = 0.0532887342791687, sd_res = 0.0676695717042626, CI_LL_95 = 0.195402872844806, CI_UL_95 = 0.276025660264967, CR_LL_80 = 0.145867467310375, CR_UL_80 = 0.325561065799397), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 40, N = 11927, mean_r = 0.311368434572998, var_r = 0.0187513471523447, var_e = 0.00275139499424615, var_res = 0.0159999521580986, sd_r = 0.136935558392788, se_r = 0.0216514128594099, sd_e = 0.0524537414704247, sd_res = 0.126490917294874, CI_LL_95 = 0.267574318376302, CI_UL_95 = 0.355162550769693, CR_LL_80 = 0.146469993677298, CR_UL_80 = 0.476266875468697), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 20, N = 5623, mean_r = 0.405322358781164, var_r = 0.0120978526896483, var_e = 0.00250533987859078, var_res = 0.00959251281105751, sd_r = 0.109990239065329, se_r = 0.0245945651411529, sd_e = 0.0500533703020164, sd_res = 0.09794137435761, CI_LL_95 = 0.353845342333019, CI_UL_95 = 0.456799375229309, CR_LL_80 = 0.275282833215711, CR_UL_80 = 0.535361884346617), individual_correction = NULL, artifact_distribution = NULL),
        list(barebones = list(k = 20, N = 6304, mean_r = 0.227564038027547, var_r = 0.00993871576823694, var_e = 0.00286244049070791, var_res = 0.00707627527752903, sd_r = 0.0996931079274638, se_r = 0.0222920566214032, sd_e = 0.05350178025737, sd_res = 0.0841205996027669, CI_LL_95 = 0.180906227296718, CI_UL_95 = 0.274221848758376, CR_LL_80 = 0.115874744974705, CR_UL_80 = 0.339253331080389), individual_correction = NULL, artifact_distribution = NULL)
      ),
      escalc = c(
        list(barebones = list(original_order = 1:40, sample_id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"), yi = c(
          0.490590361445783, 0.541125, 0.340355648535565, 0.371114457831325, 0.390767716535433, 0.340477528089888, 0.4935, 0.210495283018868, 0.230454545454545, 0.370761316872428, 0.430723905723906, 0.400704225352113,
          0.400847457627119, 0.480556844547564, 0.190646258503401, 0.511, 0.380479797979798, 0.490811258278146, 0.400689655172414, 0.390576923076923, 0.310454545454545, 0.170275080906149, 0.400641025641026, 0.380567164179104, 0.0701483050847458, 0.170658914728682, 0.390566860465116, 0.300308641975309, 0.220604395604396, 0.0200310559006211, 0.160181818181818, 0.20028901734104, 0.260300230946882, 0.240449438202247, 0.320642570281125, 0.16025078369906, 0.130188953488372, 0.300401069518717, 0.410833333333333,
          0.210388888888889
        ), vi = c(
          0.00195060915134601, 0.00337292832420247, 0.00169352049750752, 0.00487652287836502, 0.00318701888901021, 0.00227388426350729, 0.0809502797808594, 0.00381840942362544, 0.00319961580161499, 0.00333128723378022, 0.00272559864582018, 0.00285036196411477, 0.00343009660088387, 0.00187819674665567, 0.00550682175379996, 0.00317452077571997, 0.00204419898436514, 0.00268047284042581, 0.00279138895796067, 0.0023949786917414, 0.00237390849797242, 0.00261975015472037, 0.00259456024938652,
          0.0024164262621152, 0.00343009660088387, 0.00627521548688832, 0.00235320580758312, 0.00166564361689011, 0.00444781757037689, 0.00251398384412607, 0.00183977908592862, 0.00233960346187455, 0.00186952147299906, 0.00303184568467638, 0.00325101525224335, 0.00253762632541879, 0.00235320580758312, 0.00216444598344544, 0.00329066177970973, 0.0029981585104022
        ), rxy = c(
          0.49, 0.54, 0.34, 0.37, 0.39, 0.34, 0.47, 0.21, 0.23, 0.37, 0.43, 0.4, 0.4, 0.48, 0.19, 0.51, 0.38, 0.49, 0.4, 0.39, 0.31, 0.17, 0.4, 0.38,
          0.07, 0.17, 0.39, 0.3, 0.22, 0.02, 0.16, 0.2, 0.26, 0.24, 0.32, 0.16, 0.13, 0.3, 0.41, 0.21
        ), n = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), n_adj = c(
          416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247,
          271
        ), weight = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), residual = c(
          0.173926082056342, 0.224460720610559, 0.0236913691461236, 0.054450178441884, 0.0741034371459918, 0.0238132487004464, 0.176835720610559, -0.106168996370573, -0.0862097339348958, 0.0540970374829867, 0.114059626334464, 0.0840399459626714, 0.0841831782376773, 0.163892565158122,
          -0.12601802088604, 0.194335720610559, 0.0638155185903567, 0.174146978888704, 0.0840253757829725, 0.0739126436874818, -0.00620973393489582, -0.146389198483292, 0.0839767462515844, 0.0639028847896632, -0.246515974304696, -0.146005364660759, 0.073902581075675, -0.0163556374141327, -0.0960598837850457, -0.29663322348882, -0.156482461207623, -0.116375262048401, -0.056364048442559, -0.0762148411871941, 0.00397829089168322, -0.156413495690382, -0.186475325901069, -0.0162632098707247, 0.094169053943892,
          -0.106275390500552
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 1:40, moderator = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), cat_moderators = "moderator")),
        list(barebones = list(original_order = 1:20, sample_id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20"), yi = c(
          0.490590361445783, 0.541125, 0.340355648535565, 0.371114457831325, 0.390767716535433, 0.340477528089888, 0.4935, 0.210495283018868, 0.230454545454545, 0.370761316872428, 0.430723905723906, 0.400704225352113, 0.400847457627119, 0.480556844547564, 0.190646258503401, 0.511, 0.380479797979798, 0.490811258278146, 0.400689655172414,
          0.390576923076923
        ), vi = c(0.00170959246423821, 0.00295617030274523, 0.00148426960807292, 0.00427398116059552, 0.00279323178212148, 0.00199292379960353, 0.0709480872658856, 0.00334660788990026, 0.00280427222394805, 0.00291967437308171, 0.00238882448706686, 0.00249817208682696, 0.0030062748841477, 0.00164612731475373, 0.00482640049427793, 0.00278227793199551, 0.00179161836530014, 0.00234927441277767, 0.00244648576778916, 0.0020990558362688), rxy = c(
          0.49, 0.54, 0.34, 0.37, 0.39, 0.34, 0.47, 0.21,
          0.23, 0.37, 0.43, 0.4, 0.4, 0.48, 0.19, 0.51, 0.38, 0.49, 0.4, 0.39
        ), n = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), n_adj = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), weight = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), residual = c(
          0.093484425435816, 0.144019063990033, -0.0567502874744023, -0.0259914781786418, -0.00633821947453406,
          -0.0566284079200794, 0.0963940639900329, -0.186610652991099, -0.166651390555422, -0.0263446191375392, 0.0336179697139386, 0.00359828934214557, 0.00374152161715152, 0.0834509085375966, -0.206459677506566, 0.113894063990033, -0.0166261380301692, 0.0937053222681785, 0.00358371916244665, -0.00652901293304403
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 1:20, moderator = c(
          1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
          1, 1, 1
        )), cat_moderators = "moderator")),
        list(barebones = list(original_order = 21:40, sample_id = c("21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"), yi = c(
          0.310454545454545, 0.170275080906149, 0.400641025641026, 0.380567164179104, 0.0701483050847458, 0.170658914728682, 0.390566860465116, 0.300308641975309, 0.220604395604396, 0.0200310559006211, 0.160181818181818, 0.20028901734104, 0.260300230946882, 0.240449438202247, 0.320642570281125, 0.16025078369906, 0.130188953488372,
          0.300401069518717, 0.410833333333333, 0.210388888888889
        ), vi = c(0.00259130094650214, 0.00285965573707842, 0.00283215904729882, 0.002637712306738, 0.00374421026592047, 0.0068498730446297, 0.00256870239173614, 0.00181817617851282, 0.0048551297953694, 0.0027442037973827, 0.00200825823353916, 0.00255385440103246, 0.00204072430197975, 0.00330948922380985, 0.00354872940866358, 0.00277001135660574, 0.00256870239173614, 0.00236265674534019, 0.00359200659657411, 0.00327271712132308), rxy = c(
          0.31, 0.17,
          0.4, 0.38, 0.07, 0.17, 0.39, 0.3, 0.22, 0.02, 0.16, 0.2, 0.26, 0.24, 0.32, 0.16, 0.13, 0.3, 0.41, 0.21
        ), n = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), n_adj = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), weight = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), residual = c(
          0.0655420800208809, -0.0746373845275157, 0.155728560207361,
          0.13565469874544, -0.174764160348919, -0.0742535507049824, 0.145654395031452, 0.0553961765416441, -0.0243080698292689, -0.224881409533043, -0.0847306472518463, -0.0446234480926241, 0.0153877655132177, -0.00446302723141737, 0.07573010484746, -0.084661681734605, -0.114723511945292, 0.055488604085052, 0.165920867899669, -0.0345235765447757
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 21:40, moderator = c(
          2, 2, 2, 2, 2,
          2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2
        )), cat_moderators = "moderator")),
        list(barebones = list(original_order = 1:40, sample_id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"), yi = c(
          0.400481927710843, 0.561166666666667, 0.400418410041841, 0.531596385542169, 0.430846456692913, 0.46064606741573, 0.7665, 0.290683962264151, 0.561106719367589, 0.521069958847737, 0.490824915824916, 0.46080985915493,
          0.300635593220339, 0.250290023201856, 0.32108843537415, 0.380745098039216, 0.360454545454545, 0.390645695364238, 0.480827586206897, 0.510754437869822, 0.140205278592375, 0.280453074433657, 0.220352564102564, 0.430641791044776, 0.380805084745763, 0.0702713178294574, 0.300436046511628, 0.290298353909465, 0.220604395604396, 0.120186335403727, 0.190215909090909, 0.340491329479769, 0.200230946882217, 0.300561797752809, 0.260522088353414, 0.190297805642633, 0.190276162790698, 0.18024064171123, 0.190386178861789,
          0.140259259259259
        ), vi = c(
          0.00193149371674754, 0.00333987455187596, 0.00167692446119295, 0.00482873429186885, 0.00315578697815051, 0.00225160082148941, 0.080156989245023, 0.0037809900587275, 0.00316826044446731, 0.00329864153271699, 0.00269888852676845, 0.00282242919876841, 0.00339648259512809, 0.00185979093375923, 0.00545285641122605, 0.00314341134294208, 0.00202416639507634, 0.00265420494188818, 0.00276403411189734, 0.00237150855754506, 0.0023506448458951, 0.0025940773218454, 0.00256913427067381,
          0.00239274594761263, 0.00339648259512809, 0.00621372009651341, 0.00233014503619253, 0.0016493207663585, 0.00440423017829797, 0.00248934749208146, 0.0018217497555687, 0.00231667598974055, 0.00185120067540469, 0.00300213442865255, 0.00321915619457924, 0.00251275828354304, 0.00233014503619253, 0.00214323500655142, 0.00325841419695215, 0.0029687773794453
        ), rxy = c(
          0.4, 0.56, 0.4, 0.53, 0.43, 0.46, 0.73, 0.29, 0.56, 0.52, 0.49, 0.46, 0.3, 0.25, 0.32, 0.38, 0.36, 0.39, 0.48, 0.51, 0.14, 0.28, 0.22, 0.43,
          0.38, 0.07, 0.3, 0.29, 0.22, 0.12, 0.19, 0.34, 0.2, 0.3, 0.26, 0.19, 0.19, 0.18, 0.19, 0.14
        ), n = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), n_adj = c(
          416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247,
          271
        ), weight = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), residual = c(
          0.0769148673346999, 0.237599606290523, 0.0768513496656976, 0.208029325166025, 0.10727939631677, 0.137079007039587, 0.442932939623857, -0.0328830981119925, 0.237539658991446, 0.197502898471593, 0.167257855448772, 0.137242798778786, -0.0229314671558045, -0.0732770371742874,
          -0.00247862500199381, 0.0571780376630722, 0.036887485078402, 0.0670786349880949, 0.157260525830753, 0.187187377493679, -0.183361781783768, -0.0431139859424865, -0.103214496273579, 0.107074730668633, 0.0572380243696193, -0.253295742546686, -0.0231310138645156, -0.0332687064666785, -0.102962664771748, -0.203380724972417, -0.133351151285234, 0.0169242691036254, -0.123336113493926, -0.0230052626233345, -0.0630449720227298, -0.13326925473351, -0.133290897585446, -0.143326418664914, -0.133180881514355,
          -0.183307801116884
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 1:40, moderator = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), cat_moderators = "moderator")),
        list(barebones = list(original_order = 1:20, sample_id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20"), yi = c(
          0.400481927710843, 0.561166666666667, 0.400418410041841, 0.531596385542169, 0.430846456692913, 0.46064606741573, 0.7665, 0.290683962264151, 0.561106719367589, 0.521069958847737, 0.490824915824916, 0.46080985915493, 0.300635593220339, 0.250290023201856, 0.32108843537415, 0.380745098039216, 0.360454545454545, 0.390645695364238,
          0.480827586206897, 0.510754437869822
        ), vi = c(0.00162762193991692, 0.00281442960443968, 0.0014131027302626, 0.00406905484979231, 0.00265930356325009, 0.00189736827265596, 0.0675463105065523, 0.00318614672200718, 0.00266981464452776, 0.00277968355994042, 0.00227428654904216, 0.00237839121501945, 0.0028621318011251, 0.00156719977973439, 0.00459498710928927, 0.00264887492182558, 0.00170571491178162, 0.00223663279823021, 0.0023291831209156, 0.00199841155344829), rxy = c(
          0.4, 0.56, 0.4, 0.53, 0.43, 0.46,
          0.73, 0.29, 0.56, 0.52, 0.49, 0.46, 0.3, 0.25, 0.32, 0.38, 0.36, 0.39, 0.48, 0.51
        ), n = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), n_adj = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), weight = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), residual = c(
          -0.0215777544417906, 0.139106984514033, -0.0216412721107929, 0.109536703389535,
          0.00878677454027943, 0.0385863852630964, 0.344440317847366, -0.131375719888483, 0.139047037214955, 0.0990102766951027, 0.0687652336722819, 0.0387501770022957, -0.121424088932295, -0.171769658950778, -0.100971246778484, -0.0413145841134183, -0.0616051366980885, -0.0314139867883956, 0.0587679040542626, 0.0886947557171885
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 1:20, moderator = c(
          1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
          1, 1, 1, 1, 1, 1, 1, 1
        )), cat_moderators = "moderator")),
        list(barebones = list(original_order = 21:40, sample_id = c("21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"), yi = c(
          0.140205278592375, 0.280453074433657, 0.220352564102564, 0.430641791044776, 0.380805084745763, 0.0702713178294574, 0.300436046511628, 0.290298353909465, 0.220604395604396, 0.120186335403727, 0.190215909090909, 0.340491329479769, 0.200230946882217, 0.300561797752809, 0.260522088353414, 0.190297805642633, 0.190276162790698,
          0.18024064171123, 0.190386178861789, 0.140259259259259
        ), vi = c(0.0026157320168566, 0.00288661688591618, 0.00285886095432083, 0.00266258094850179, 0.00377951109215297, 0.00691445440114806, 0.00259292040043052, 0.00183531814351461, 0.00490090449312143, 0.00277007645263385, 0.00202719231306386, 0.00257793242123728, 0.00205996447516882, 0.00334069145224007, 0.00358218721987189, 0.00279612732836395, 0.00259292040043052, 0.00238493213301631, 0.00362587242987032, 0.0033035726583263), rxy = c(
          0.14, 0.28,
          0.22, 0.43, 0.38, 0.07, 0.3, 0.29, 0.22, 0.12, 0.19, 0.34, 0.2, 0.3, 0.26, 0.19, 0.19, 0.18, 0.19, 0.14
        ), n = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), n_adj = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), weight = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), residual = c(
          -0.0955089879625108, 0.0447388078787708, -0.0153617024523221,
          0.19492752448989, 0.145090818190877, -0.165442948725429, 0.0647217799567417, 0.0545840873545788, -0.0151098709504906, -0.11552793115116, -0.0454983574639771, 0.104777062924883, -0.0354833196726691, 0.0648475311979228, 0.0248078217985275, -0.045416460912253, -0.0454381037641885, -0.0554736248436563, -0.0453280876930976, -0.0954550072956269
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 21:40, moderator = c(
          2, 2, 2, 2, 2,
          2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2
        )), cat_moderators = "moderator")),
        list(barebones = list(original_order = 1:40, sample_id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"), yi = c(
          0.360433734939759, 0.621291666666667, 0.530554393305439, 0.451355421686747, 0.360708661417323, 0.190266853932584, 0.504, 0.230542452830189, 0.370731225296443, 0.340699588477366, 0.470791245791246, 0.25044014084507,
          0.390826271186441, 0.530614849187935, 0.280952380952381, 0.410803921568627, 0.480606060606061, 0.41067880794702, 0.400689655172414, 0.430636094674556, 0.100146627565982, 0.380614886731392, 0.0100160256410256, 0.270402985074627, 0.200423728813559, 0.341317829457364, 0.380552325581395, 0.100102880658436, 0.401098901098901, 0.160248447204969, 0.22025, 0.310447976878613, 0.210242494226328, 0.240449438202247, 0.250502008032129, 0.190297805642633, 0.32046511627907, 0.240320855614973, 0.200406504065041,
          0.210388888888889
        ), vi = c(
          0.00196505724571182, 0.00339791148737669, 0.00170606434512637, 0.00491264311427955, 0.00321062502744254, 0.00229072684542249, 0.0815498756970406, 0.0038466922498604, 0.00322331524494231, 0.00335596196284118, 0.00274578706050642, 0.00287147449637467, 0.00345550320750172, 0.00189210848485013, 0.00554761059163541, 0.00319803434106041, 0.00205934029537981, 0.00270032700983578, 0.0028120646792083, 0.00241271821588877, 0.00239149195592494, 0.00263915455330228, 0.00261377806721284,
          0.00243432464767285, 0.00345550320750172, 0.00632169579046826, 0.0023706359214256, 0.00167798098142059, 0.00448076240093629, 0.00253260483531182, 0.00185340626584183, 0.00235693282361389, 0.00188336895374228, 0.00305430246056332, 0.0032750954095197, 0.0025564224356439, 0.0023706359214256, 0.00218047795981392, 0.00331503559744067, 0.00302036576655706
        ), rxy = c(
          0.36, 0.62, 0.53, 0.45, 0.36, 0.19, 0.48, 0.23, 0.37, 0.34, 0.47, 0.25, 0.39, 0.53, 0.28, 0.41, 0.48, 0.41, 0.4, 0.43, 0.1, 0.38, 0.01, 0.27,
          0.2, 0.34, 0.38, 0.1, 0.4, 0.16, 0.22, 0.31, 0.21, 0.24, 0.25, 0.19, 0.32, 0.24, 0.2, 0.21
        ), n = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), n_adj = c(
          416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247,
          271
        ), weight = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339, 342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), residual = c(
          0.0490653003667614, 0.309923232093669, 0.219185958732442, 0.139986987113749, 0.0493402268443253, -0.121101580640413, 0.192631565427002, -0.0808259817428089, 0.0593627907234451, 0.0293311539043687, 0.159422811218248, -0.0609282937279271, 0.0794578366134431, 0.219246414614937,
          -0.0304160536206166, 0.0994354869956299, 0.169237626033063, 0.0993103733740223, 0.0893212205994162, 0.119267660101559, -0.211221807007015, 0.069246452158394, -0.301352408931972, -0.0409654494983707, -0.110944705759438, 0.0299493948843668, 0.0691838910083978, -0.211265553914561, 0.0897304665259036, -0.151119987368029, -0.0911184345729976, -0.000920457694384869, -0.10112594034667, -0.0709189963707504, -0.060866426540869, -0.121070628930364, 0.0090966817060722, -0.0710475789580243, -0.110961930507957,
          -0.100979545684109
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 1:40, moderator = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2)), cat_moderators = "moderator")),
        list(barebones = list(original_order = 1:20, sample_id = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20"), yi = c(
          0.360433734939759, 0.621291666666667, 0.530554393305439, 0.451355421686747, 0.360708661417323, 0.190266853932584, 0.504, 0.230542452830189, 0.370731225296443, 0.340699588477366, 0.470791245791246, 0.25044014084507, 0.390826271186441, 0.530614849187935, 0.280952380952381, 0.410803921568627, 0.480606060606061, 0.41067880794702,
          0.400689655172414, 0.430636094674556
        ), vi = c(0.0016829338101881, 0.0029100730467836, 0.00146112454231812, 0.00420733452547026, 0.00274967531979552, 0.00196184699783164, 0.0698417531228063, 0.0032944223171135, 0.00276054360169195, 0.00287414621904553, 0.00235157417921907, 0.00245921665925374, 0.00295939631876298, 0.00162045830911384, 0.00475113966821812, 0.00273889227932574, 0.0017636806344143, 0.002312640831881, 0.00240833631457953, 0.00206632405688776), rxy = c(
          0.36, 0.62, 0.53, 0.45, 0.36, 0.19,
          0.48, 0.23, 0.37, 0.34, 0.47, 0.25, 0.39, 0.53, 0.28, 0.41, 0.48, 0.41, 0.4, 0.43
        ), n = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), n_adj = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), weight = c(416, 241, 479, 167, 255, 357, 11, 213, 254, 244, 298, 285, 237, 432, 148, 256, 397, 303, 291, 339), residual = c(
          -0.0448886238414049, 0.215969307885503, 0.125232034524275, 0.0460330629055832,
          -0.044613697363841, -0.21505550484858, 0.0986776412188362, -0.174779905950975, -0.0345911334847211, -0.0646227703037976, 0.0654688870100819, -0.154882217936093, -0.0144960875947232, 0.125292490406771, -0.124369977828783, 0.00548156278746359, 0.0752837018248967, 0.00535644916585598, -0.00463270360875007, 0.0253137358933924
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 1:20, moderator = c(
          1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
          1, 1, 1, 1, 1, 1, 1, 1, 1
        )), cat_moderators = "moderator")),
        list(barebones = list(original_order = 21:40, sample_id = c("21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"), yi = c(
          0.100146627565982, 0.380614886731392, 0.0100160256410256, 0.270402985074627, 0.200423728813559, 0.341317829457364, 0.380552325581395, 0.100102880658436, 0.401098901098901, 0.160248447204969, 0.22025, 0.310447976878613, 0.210242494226328, 0.240449438202247, 0.250502008032129, 0.190297805642633, 0.32046511627907,
          0.240320855614973, 0.200406504065041, 0.210388888888889
        ), vi = c(0.0026366889852082, 0.0029097441551974, 0.00288176584601281, 0.00268391326554029, 0.00380979213540677, 0.00696985227872866, 0.00261369460452325, 0.00185002251842798, 0.00494017002173625, 0.00279227001228571, 0.00204343396353636, 0.00259858654322543, 0.00207646869273902, 0.00336745671893632, 0.00361088732512449, 0.00281852960487774, 0.00261369460452325, 0.0024040399571016, 0.00365492253640649, 0.00333004053317036), rxy = c(
          0.1, 0.38,
          0.01, 0.27, 0.2, 0.34, 0.38, 0.1, 0.4, 0.16, 0.22, 0.31, 0.21, 0.24, 0.25, 0.19, 0.32, 0.24, 0.2, 0.21
        ), n = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), n_adj = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), weight = c(342, 310, 313, 336, 237, 130, 345, 487, 183, 323, 441, 347, 434, 268, 250, 320, 345, 375, 247, 271), residual = c(
          -0.127417410461565, 0.153050848703844, -0.217548012386522,
          0.0428389470470797, -0.0271403092139879, 0.113753791429817, 0.152988287553848, -0.127461157369111, 0.173534863071354, -0.0673155908225783, -0.00731403802754721, 0.0828839388510655, -0.0173215438012193, 0.0128854001747, 0.0229379700045813, -0.037266232384914, 0.0929010782515226, 0.0127568175874261, -0.0271575339625066, -0.0171751491386583
        )), individual_correction = NULL, artifact_distribution = NULL, moderator_info = list(moderator_matrix = list(original_order = 21:40, moderator = c(
          2, 2, 2, 2, 2,
          2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2
        )), cat_moderators = "moderator"))
      ),
      construct_x = as.factor(c("X", "X", "X", "X", "X", "X", "Y", "Y", "Y")),
      construct_y = as.factor(c("Y", "Y", "Y", "Z", "Z", "Z", "Z", "Z", "Z")),
      analysis_type = as.factor(c(
        "Overall",
        "Simple Moderator", "Simple Moderator", "Overall",
        "Simple Moderator", "Simple Moderator", "Overall",
        "Simple Moderator", "Simple Moderator"
      )),
      moderator = as.factor(c(
        "All Levels", "1",
        "2", "All Levels", "1", "2", "All Levels", "1",
        "2"
      ))
    )


  expect_equal(
    ma_r(
      rxyi = rxyi, n = n, rxx = rxxi, ryy = ryyi,
      construct_x = x_name, construct_y = y_name, sample_id = sample_id,
      moderators = moderator, data = data_r_meas_multi
    ),
    expected
  )
})
